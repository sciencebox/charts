image:
  repository: gitlab-registry.cern.ch/sciencebox/docker-images/frontier-squid
  tag: 4.15-2.1
  pullPolicy: IfNotPresent

#
# Number of frontier-squid pods to run
#
#   Squid is seamlessly load-balanced via its network service. Running more replicas
#     will provide more capacity and the ability to serve more clients.
#   Consider enabling PodAntiAffinity to increase availability.
#
replicas: 1

#
# Assign frontier-squid pod(s) to a node with a specific label
#   and distribute them on different nodes to avoid single points of failure.
#
#
podAssignment:
  # If true, requires a node labeled as per customLabels.
  enableNodeSelector: false
  # If true, shard the stateful set on as many nodes as possible.
  #   Relevant only when running multiple replicas
  #   Highly recommended for production scenarios
  enablePodAntiAffinity: false

#
# Custom labels to identify frontier-squid pod(s).
#
# They are used by node selection, if enabled (see above).
# Label nodes accordingly to avoid scheduling problems.
#
customLabels:
  service: cvmfs
  component: frontier-squid

#
# Enable or disable health probes.
#   Docs: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
#
# Liveness Probe:
#   Checks every 10 seconds whether it is possible to open a TCP socket againsts port 3128.
#   The frontier-squid container will be restarted after 3 failures.
#
# Readiness Probe:
#   Checks every 30 seconds whether 'http://cvmfs-stratum-one.cern.ch/cvmfs/info/v1/meta.json' is alive using the squid in the pod as proxy.
#   If unreachable, the failing frontier-squid pod will be removed from the service load-balanced alias.
#
# Default: All probes enabled.
#
probes:
  liveness: true
  readiness: true

#
# Squid configuration
#
#   - configFile: Provide a full configuration file.
#       Overrides the provided configMap only if provided and the file exists
#   - config: Parameters to change default valules in the provided configMap.
#
configFile: files/mysquid.conf
config:
  fileDescriptors: 16384
  cache:
    minSize: "0 KB"             # Applies to both in-memory and on disk caches
    diskDirectory: "/var/cache/squid"
    diskSpace: 10000    # in MB
    diskMaxSize: "1 GB"         # Maximum object size to be cached on disk
    memorySpace: "256 MB"
    memoryMaxSize: "32 KB"      # Maximum object size to be cached in memory

service:
  type: ClusterIP
  ports:
    - port: 3128
      targetPort: 3128
      protocol: TCP
      name: squid
